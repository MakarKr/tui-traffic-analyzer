# TUI Traffic Analyzer

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg "Python 3.8+")
![License](https://img.shields.io/badge/License-GPL--3.0-green.svg "License: GPL-3.0")
![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Windows%20%7C%20macOS-lightgrey.svg "Platform: Linux | Windows | MacOS")

**TUI Traffic Analyzer** - это консольный инструмент для анализа сетевого трафика с интерактивным текстовым интерфейсом (TUI). Программа позволяет захватывать, анализировать и визуализировать сетевые пакеты, обнаруживать уязвимости в SSL/TLS соединениях, проводить MITM атаки и сканировать локальную сеть.

## Особенности

- **Захват трафика** в реальном времени
- **Анализ протоколов**: HTTP, HTTPS, DNS, TCP, UDP
- **Обнаружение уязвимостей** в SSL/TLS соединениях
- **MITM атаки** (ARP Spoofing)
- **Сканирование сети** с определением производителей устройств
- **Интерактивный TUI интерфейс** на базе curses
- **Сохранение и экспорт** данных в JSON
- **Кроссплатформенность** (Linux, Windows, macOS)

## Платформенные особенности

### Linux/macOS
- Полная функциональность
- Требуются права root для сниффинга
- MITM атаки работают в полном объеме

### Windows

Программа автоматически определяет наличие Npcap и адаптирует функциональность:

#### Без Npcap (ограниченный режим)

- Ограниченная функциональность
- Только анализ локального трафика
- MITM атаки в демо-режиме
- Без установки дополнительных драйверов

- Демонстрационный режим MITM атак
- Симуляция работы ARP spoofing
- Ознакомление с интерфейсом без реального воздействия на сеть
- Безопасно для тестирования и обучения

#### С [Npcap](https://nmap.org/npcap/)/WinPcap (рекомендуется)

- Анализ локального трафика (входящего/исходящего с вашего компьютера)
- Детектирование HTTP/HTTPS/DNS соединений
- Демо-режим MITM атак
- Сетевой сканер (ограниченный)

- Реальные ARP spoofing атаки
- Полный перехват трафика между устройствами
- Автоматическое включение/выключение IP forwarding
- Восстановление сети после атаки

> Рекомендации:
>
> - Для образовательных целей можно использовать демо-режим
>
> - Для полной функциональности на Windows рекомендуется установить Npcap:
>
> > 1. Скачайте с [официального сайта](https://nmap.org/npcap/)
> > 2. Выберите "Install Npcap in WinPcap API-compatible mode"
> > 3. Перезагрузите компьютер
>
> Всегда получайте разрешение перед тестированием на чужих сетях

## Установка

### Требования

- Python 3.8+
- Права администратора (для захвата трафика и MITM атак)
- Установленные зависимости

### Клонирование репозитория и установка зависимостей *в виртуальное окружение*

#### Linux/macOS

```bash
git clone https://github.com/MakarKr/tui-traffic-analyzer  # Клонирование репозитория
cd tui-traffic-analyzer                                    # Переход в склонированный репозиторий
python -m venv .venv                                       # Создать виртуальное окружение
source .venv/bin/activate                                  # Активировать
pip install -r requirements.txt                            # Установить зависимости
```

#### Windows

```bash
git clone https://github.com/MakarKr/tui-traffic-analyzer  # Клонирование репозитория
cd tui-traffic-analyzer                                    # Переход в склонированный репозиторий
python -m venv .venv                                       # Создать виртуальное окружение
.\.venv\Scripts\activate                                   # Активировать
pip install -r requirements.txt                            # Установить зависимости
pip install windows-curses                                 # Установка дополнительной зависимости (только для Windows)
```

### Запуск

```bash
sudo python3 main.py
```

> **Примечание**: Для полноценной работы требуются права root/administrator.

## Использование

После запуска вы попадете в интерактивный текстовый интерфейс с несколькими вкладками:

| Клавиша | Действие                         |
|---------|----------------------------------|
| `1-6`   | Переключение между вкладками     |
| `↑/↓`   | Навигация по спискам             |
| `Enter` | Выбор элемента/запуск действия   |
| `S`     | Запуск/остановка захвата трафика |
| `C`     | Очистка данных                   |
| `E`     | Экспорт данных в JSON            |
| `Q`     | Выход из программы               |

### Вкладки

| Вкладка       | Описание                                            |
|---------------|-----------------------------------------------------|
| **Dashboard** | Общая статистика и информация о захваченном трафике |
| **Packets**   | Список захваченных пакетов с детальной информацией  |
| **Sessions**  | Активные сессии и соединения                        |
| **MITM**      | Управление MITM атаками (ARP Spoofing)              |
| **Scanner**   | Сканирование локальной сети                         |
| **Settings**  | Настройки интерфейса и параметров захвата           |

## Возможности анализа

### HTTP трафик
- Захват HTTP запросов и ответов
- Анализ заголовков и тела сообщений
- Отображение методов, URL и статусов ответов

### HTTPS трафик
- Анализ метаданных TLS соединений
- Обнаружение SNI (Server Name Indication)
- Проверка сертификатов
- Обнаружение уязвимостей (устаревшие протоколы, слабые шифры)

### DNS трафик
- Захват DNS запросов и ответов
- Анализ доменных имен и IP адресов

### MITM атаки (ARP Spoofing)
- **Полнофункциональный ARP spoofing** на Linux/macOS
- **Гибкая работа на Windows**:
  - **С Npcap/WinPcap**: Полнофункциональные MITM атаки с реальным ARP spoofing
  - **Без Npcap**: Демо-режим с симуляцией атаки для ознакомления с интерфейсом
- **Автоматическое определение возможностей системы**:
  - Автоматическое обнаружение Npcap на Windows
  - Интеллектуальное переключение между режимами
- **Безопасное восстановление сети**:
  - Автоматическое восстановление ARP таблиц при остановке атаки
  - Восстановление IP forwarding (на Linux)
- **Интерактивная настройка**:
  - Установка цели и шлюза через TUI интерфейс
  - Быстрый выбор целей из результатов сканирования сети
  - Настройка интервалов отправки ARP пакетов

### Сетевой сканер
- Сканирование локальной сети
- Определение активных хостов
- Идентификация производителей по MAC адресу

## Важные замечания

1. **HTTPS расшифровка**: Полная расшифровка HTTPS трафика **невозможна** без:
   - Закрытого ключа сервера
   - Конфигурации клиентского браузера
   - Предварительно установленных ключей

2. **Законность**: Используйте этот инструмент **только** в образовательных целях и на сетях, где у вас есть разрешение на тестирование.

3. **Безопасность**: MITM атаки могут нарушать работу сети. Используйте с осторожностью.

## Примеры использования

### Захват HTTP трафика
1. Перейдите на вкладку **Settings** (6)
2. Выберите сетевой интерфейс
3. Вернитесь на вкладку **Dashboard** (1)
4. Нажмите `S` для начала захвата
5. Откройте браузер и посетите HTTP сайты
6. Просмотрите захваченные пакеты на вкладке **Packets** (2)

### Сканирование сети
1. Перейдите на вкладку **Scanner** (5)
2. Нажмите `Enter` для запуска сканирования
3. Дождитесь завершения сканирования
4. Выберите хост для дальнейшего анализа

### MITM атака
1. Перейдите на вкладку **MITM** (4)
2. Нажмите `Enter` для запуска атаки (по умолчанию на шлюз)
3. Захваченный трафик будет отображаться на других вкладках
4. Нажмите `Enter` снова для остановки атаки

## Структура проекта

```
tui-traffic-analyzer/
├── config.py            # Конфигурация приложения
├── main.py              # Точка входа
├── mitm_attacker.py     # Реализация MITM атак
├── network_scanner.py   # Сетевой сканер
├── packet_analyzer.py   # Анализатор пакетов
├── session_manager.py   # Управление сессиями и хранение данных
├── sslanalyzer.py       # Анализ SSL/TLS соединений
├── tui.py               # Интерактивный интерфейс
├── utils.py             # Вспомогательные функции
├── requirements.txt     # Зависимости
└── sessions.db          # База данных сессий
```

### **`network_scanner.py` – Класс `NetworkScanner`**
**Назначение**: Сканирование локальной сети для обнаружения активных устройств.

| **Функция**               | **Описание**                                                                                                                                     |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| `__init__`                | Инициализирует список хостов (`self.hosts`), флаг сканирования (`scanning`) и поток (`scan_thread`).                                             |
| `scan_network`            | Сканирует заданный диапазон сети (`network_range`) с помощью ARP-запросов (Scapy). Возвращает список активных хостов с IP, MAC и производителем. |
| `scan_async`              | Запускает асинхронное сканирование сети в отдельном потоке и вызывает `callback` по завершении.                                                  |
| `stop_scan`               | Останавливает текущее сканирование.                                                                                                              |
| `get_vendor_by_mac`       | Определяет производителя устройства по MAC-адресу (использует локальную базу OUI).                                                               |
| `get_local_network_range` | Вычисляет диапазон локальной сети на основе IP и маски интерфейса.                                                                               |

### **`packet_analyzer.py` – Класс `PacketAnalyzer`**
**Назначение**: Анализ сетевых пакетов (HTTP, HTTPS, DNS, TCP, UDP).

| **Функция**                  | **Описание**                                                                   |
|------------------------------|--------------------------------------------------------------------------------|
| `__init__`                   | Инициализирует менеджер сессий (`session_manager`), флаги и счетчики.          |
| `start_sniffing`             | Запускает захват пакетов на указанном интерфейсе с заданным фильтром.          |
| `stop_sniffing`              | Останавливает захват пакетов.                                                  |
| `process_packet`             | Обрабатывает захваченный пакет (HTTP, HTTPS, DNS, TCP, UDP).                   |
| `extract_tls_info`           | Извлекает информацию из TLS-пакетов (SNI, сертификаты, шифры).                 |
| `detect_ssl_vulnerabilities` | Анализирует TLS-соединение на уязвимости (устаревшие протоколы, слабые шифры). |
| `_process_http_request`      | Обрабатывает HTTP-запросы (метод, URL, заголовки, POST-данные).                |
| `_process_http_response`     | Обрабатывает HTTP-ответы (статус, заголовки, тело ответа).                     |
| `_process_https_metadata`    | Обрабатывает метаданные HTTPS (SNI, направление трафика, уязвимости).          |
| `_process_dns`               | Обрабатывает DNS-запросы и ответы.                                             |
| `_process_tcp_connection`    | Обрабатывает TCP-соединения (флаги, последовательности).                       |
| `_process_udp_session`       | Обрабатывает UDP-сессии.                                                       |
| `get_statistics`             | Возвращает статистику анализатора (количество пакетов, байт, интерфейс).       |

### **`tui.py` – Класс `TUI`**
**Назначение**: Текстовый интерфейс (TUI) для взаимодействия с пользователем.

| **Функция**                    | **Описание**                                                           |
|--------------------------------|------------------------------------------------------------------------|
| `__init__`                     | Инициализирует curses, менеджеры сессий/пакетов, сканер и атаку MITM.  |
| `init_curses`                  | Настраивает цвета и параметры curses.                                  |
| `sanitize_string`              | Очищает строку от непечатаемых символов.                               |
| `safe_addstr`                  | Безопасно выводит строку в curses (обрабатывает ошибки).               |
| `run`                          | Главный цикл TUI (обработка ввода, отрисовка).                         |
| `handle_input`                 | Обрабатывает нажатия клавиш (переключение вкладок, навигация).         |
| `handle_up` / `handle_down`    | Обработка клавиш ↑/↓ для навигации по спискам.                         |
| `handle_left` / `handle_right` | Обработка клавиш ←/→ для прокрутки.                                    |
| `handle_enter`                 | Обработка нажатия Enter (запуск сканирования, MITM, выбор интерфейса). |
| `toggle_sniffing`              | Включает/выключает захват пакетов.                                     |
| `toggle_mitm`                  | Запускает/останавливает атаку MITM.                                    |
| `start_scan` / `stop_scan`     | Запускает/останавливает сканирование сети.                             |
| `on_scan_complete`             | Обработчик завершения сканирования.                                    |
| `draw`                         | Отрисовывает интерфейс (заголовок, вкладки, содержимое, статус).       |
| `draw_header` / `draw_tabs`    | Отрисовывает заголовок и вкладки.                                      |
| `draw_dashboard`               | Отображает статистику (пакеты, сессии, протоколы).                     |
| `draw_packets`                 | Отображает список захваченных пакетов.                                 |
| `draw_sessions`                | Отображает список сессий.                                              |
| `draw_mitm`                    | Отображает панель MITM (статус атаки).                                 |
| `draw_scanner`                 | Отображает результаты сканирования сети.                               |
| `draw_settings`                | Отображает настройки (выбор интерфейса).                               |
| `draw_status_bar`              | Отображает статусную строку (текущий таб, интерфейс, навигация).       |

### **`session_manager.py` – Класс `SessionManager`**
**Назначение**: Управление сессиями и пакетами (хранение, экспорт, статистика).

| **Функция**        | **Описание**                                                     |
|--------------------|------------------------------------------------------------------|
| `__init__`         | Инициализирует базу данных SQLite для хранения сессий и пакетов. |
| `init_database`    | Создает таблицы `sessions` и `packets` в БД.                     |
| `add_packet`       | Добавляет пакет в сессию и сохраняет в БД.                       |
| `_save_to_db`      | Сохраняет пакет и сессию в базу данных.                          |
| `get_sessions`     | Возвращает список сессий (с ограничением по количеству).         |
| `get_packets`      | Возвращает список пакетов (по сессии или все).                   |
| `get_statistics`   | Возвращает статистику (количество пакетов, сессий, протоколы).   |
| `clear_all`        | Очищает все данные (пакеты, сессии, БД).                         |
| `export_to_json`   | Экспортирует данные в JSON-файл.                                 |
| `import_from_json` | Импортирует данные из JSON-файла.                                |

### **`sslanalyzer.py` – Класс `SSLAnalyzer`**
**Назначение**: Анализ безопасности SSL/TLS-соединений.

| **Функция**             | **Описание**                                                              |
|-------------------------|---------------------------------------------------------------------------|
| `__init__`              | Инициализирует базу уязвимостей (слабые шифры, устаревшие протоколы).     |
| `analyze_ssl_handshake` | Анализирует TLS-рукопожатие на уязвимости (протокол, шифры, сертификаты). |
| `detect_middlebox`      | Обнаруживает промежуточные устройства (middlebox) в TLS-трафике.          |
| `generate_fingerprint`  | Генерирует отпечаток TLS-соединения (MD5-хэш).                            |
| `get_security_report`   | Формирует отчет о безопасности TLS-соединения.                            |

### **`mitm_attacker.py` – Класс `MITMAttacker`**
**Назначение**: Реализация атаки "человек посередине" (ARP-спуфинг).

| **Функция**    | **Описание**                                                                  |
|----------------|-------------------------------------------------------------------------------|
| `__init__`     | Инициализирует параметры атаки (цель, шлюз, интерфейс) и получает MAC-адреса. |
| `_get_macs`    | Получает MAC-адреса цели, шлюза и атакующего.                                 |
| `_get_mac`     | Получает MAC-адрес по IP (из ARP-кэша или отправкой ARP-запроса).             |
| `spoof`        | Отправляет поддельный ARP-пакет для спуфинга.                                 |
| `restore`      | Восстанавливает ARP-таблицы цели и шлюза.                                     |
| `start_attack` | Запускает MITM-атаку (включает IP-forwarding, отправляет ARP-пакеты).         |
| `stop_attack`  | Останавливает атаку и восстанавливает сеть.                                   |
| `get_status`   | Возвращает статус атаки (цель, шлюз, статистика).                             |

### **`config.py` – Класс `Config`**
**Назначение**: Хранение конфигурационных параметров приложения.

| **Функция/Параметр**  | **Описание**                                                 |
|-----------------------|--------------------------------------------------------------|
| `SNIFF_TIMEOUT`       | Таймаут сниффинга.                                           |
| `SNIFF_FILTER`        | Фильтр для захвата пакетов (по умолчанию: HTTP, HTTPS, DNS). |
| `MAX_PACKETS_DISPLAY` | Максимальное количество отображаемых пакетов.                |
| `ARP_SPOOF_INTERVAL`  | Интервал отправки ARP-пакетов при MITM.                      |
| `colors`              | Цветовые схемы для TUI.                                      |
| `load_from_file`      | Загружает конфигурацию из JSON-файла.                        |
| `save_to_file`        | Сохраняет конфигурацию в JSON-файл.                          |

### **`utils.py` – Вспомогательные функции**
**Назначение**: Утилиты для работы с сетью, форматированием и системой.

| **Функция**                    | **Описание**                                       |
|--------------------------------|----------------------------------------------------|
| `get_network_interfaces`       | Возвращает список сетевых интерфейсов.             |
| `get_interface_info`           | Получает информацию об интерфейсе (IP, MAC, шлюз). |
| `enable_ip_forwarding`         | Включает IP-forwarding (для MITM).                 |
| `disable_ip_forwarding`        | Выключает IP-forwarding.                           |
| `calculate_network_range`      | Вычисляет диапазон сети по IP и маске.             |
| `is_valid_ip` / `is_valid_mac` | Проверяет валидность IP/MAC-адреса.                |
| `format_bytes`                 | Форматирует размер в байтах (KB, MB, GB).          |
| `format_time_delta`            | Форматирует временной интервал (мс, с, мин, ч).    |
| `clear_screen`                 | Очищает экран терминала.                           |
| `check_root`                   | Проверяет наличие root-прав.                       |

### **`main.py` – Точка входа**
**Назначение**: Запуск приложения.

| **Функция**               | **Описание**                                                     |
|---------------------------|------------------------------------------------------------------|
| `enable_https_decryption` | Выводит предупреждение о невозможности полной расшифровки HTTPS. |
| `main`                    | Запускает TUI (через `curses.wrapper`).                          |

### **Общая архитектура проекта**
| Выполняемая функция         | Класс                               |
| --------------------------- | ----------------------------------- |
| **Сканирование сети**       | `NetworkScanner`                    |
| **Захват и анализ трафика** | `PacketAnalyzer` + `SessionManager` |
| **Атака MITM**              | `MITMAttacker`                      |
| **Анализ SSL/TLS**          | `SSLAnalyzer`                       |
| **Текстовый интерфейс**     | `TUI`                               |
| **Конфигурация**            | `Config`                            |
| **Утилиты**                 | `utils`                             |

Проект реализует **полноценный анализатор трафика** с возможностями:
- Сканирования сети.
- Захвата и анализа пакетов (HTTP, HTTPS, DNS).
- Атаки MITM (ARP-спуфинг).
- Анализ безопасности SSL/TLS.
- Сохранение и экспорт данных.

## Лицензия

**GNU GPLv3** – [Полный текст лицензии](LICENSE).

Этот проект является свободным программным обеспечением. Вы можете распространять и/или изменять его в соответствии с условиями GNU General Public License версии 3 или (по вашему выбору) любой более поздней версии.

**Важно**: Использование инструмента в незаконных целях строго запрещено. Подробнее см. в [DISCLAIMER.md](DISCLAIMER.md).
